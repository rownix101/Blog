---
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import PageHead from '@/components/PageHead.astro'
import { languages, ui } from '@/i18n/ui'
import { useTranslations } from '@/i18n/utils'
import Layout from '@/layouts/Layout.astro'
import { Icon } from 'astro-icon/components'
import { getCollection, render } from 'astro:content'

export async function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({ params: { lang } }))
}

const { lang } = Astro.params
const locale = (lang || 'zh-cn').toLowerCase()
const t = useTranslations(locale as keyof typeof ui)

// Get terms content
const legalDocs = await getCollection('legal')
const preferredLangs = [locale, 'en', 'zh-cn']
const termsDoc = preferredLangs
  .map((preferredLang) =>
    legalDocs.find((doc) => doc.id === `terms.${preferredLang}`),
  )
  .find(Boolean)

if (!termsDoc) {
  throw new Error(`Terms of service not found for language: ${lang}`)
}

const { Content } = await render(termsDoc)
---

<Layout class="max-w-3xl" lang={locale}>
  <PageHead slot="head" title={termsDoc.data.title} />
  <Breadcrumbs
    items={[{ label: termsDoc.data.title, icon: 'lucide:file-text' }]}
  />

  <article class="prose prose-neutral dark:prose-invert max-w-none">
    <div class="bg-card/50 mb-6 rounded-lg border p-6">
      <div class="mb-2 flex items-center gap-3">
        <Icon name="lucide:file-text" class="text-primary size-6" />
        <h1 class="m-0 text-3xl font-bold">{termsDoc.data.title}</h1>
      </div>
      {
        termsDoc.data.date && (
          <p class="text-muted-foreground m-0 text-sm">
            {t('legal.last_updated')}:{' '}
            {termsDoc.data.date.toISOString().split('T')[0]}
          </p>
        )
      }
    </div>

    <section class="mb-8 space-y-6">
      <Content />
    </section>
  </article>
</Layout>
