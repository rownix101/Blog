---
import BlogCard from '@/components/BlogCard.astro'
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import PageHead from '@/components/PageHead.astro'
import { languages, ui } from '@/i18n/ui'
import { useLocalizedPath } from '@/i18n/utils'
import Layout from '@/layouts/Layout.astro'
import { getAllAuthors, getPostsByAuthor } from '@/lib/data-utils'

export async function getStaticPaths() {
    const authors = await getAllAuthors()
    const paths = []
    for (const lang of Object.keys(languages)) {
        for (const author of authors) {
            paths.push({
                params: { lang, id: author.id },
                props: { author },
            })
        }
    }
    return paths
}

const { author } = Astro.props
const { lang, id } = Astro.params
const posts = await getPostsByAuthor(id as string, lang)

const l = useLocalizedPath(lang as keyof typeof ui)
---

<Layout class="max-w-3xl" lang={lang}>
    <PageHead slot="head" title={author.data.name} />
    <Breadcrumbs
        items={[
            {
                label: lang === 'en' ? 'Authors' : '作者',
                href: l('/authors'),
                icon: 'lucide:users',
            },
            { label: author.data.name, icon: 'lucide:user' },
        ]}
    />

    <section class="flex flex-col gap-y-4">
        <div class="flex flex-col gap-y-2">
            <h1 class="text-3xl font-bold">{author.data.name}</h1>
            <p class="text-muted-foreground">{author.data.bio}</p>
        </div>

        <div class="flex flex-col gap-y-4">
            <h2 class="text-2xl font-semibold">
                {lang === 'en' ? 'Posts' : '文章'}
            </h2>
            <div class="flex flex-col gap-y-2">
                {posts.map((post) => <BlogCard entry={post} />)}
            </div>
        </div>
    </section>
</Layout>
