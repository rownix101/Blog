---
import FriendCard from '@/components/FriendCard'
import { SITE } from '@/consts'
import { languages, ui, type Lang } from '@/i18n/ui'
import Layout from '@/layouts/Layout.astro'
import { getApprovedFriends, getFriendCategories } from '@/lib/friends-utils'

export async function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({ params: { lang } }))
}

const { lang } = Astro.params
const t = ui[lang as Lang]
const allFriends = getApprovedFriends()
const categories = getFriendCategories()

// Simply show all friends, no filtering
const filteredFriends = allFriends

// SEO
const title = `${t['nav.friends'] || 'Friends'} - ${SITE.title}`
const description =
  t['friends.page_desc'] ||
  'Discover amazing blogs and websites from our friends'
---

<Layout title={title} description={description}>
  <div class="container mx-auto max-w-4xl px-4 py-12">
    <!-- Header -->
    <header class="mb-12 text-center">
      <h1 class="mb-4 text-4xl font-bold">
        {t['friends.title'] || 'Friends'}
      </h1>
      <p class="text-muted-foreground mb-8 text-xl">
        {
          t['friends.page_desc'] ||
            'Discover amazing blogs and websites from our friends'
        }
      </p>

      <!-- Stats -->
      <div class="mb-8 flex justify-center gap-8">
        <div class="text-center">
          <div class="text-primary text-2xl font-bold">{allFriends.length}</div>
          <div class="text-muted-foreground text-sm">
            {t['friends.total_friends'] || 'Total Friends'}
          </div>
        </div>
        <div class="text-center">
          <div class="text-primary text-2xl font-bold">{categories.length}</div>
          <div class="text-muted-foreground text-sm">
            {t['friends.categories'] || 'Categories'}
          </div>
        </div>
      </div>

      <!-- Apply Button -->
      <div class="mb-8">
        <a
          href={`/${lang}/friends/apply`}
          class="bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center gap-2 rounded-lg px-6 py-3 transition-colors"
        >
          <svg
            class="h-5 w-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width={2}
              d="M12 4v16m8-8H4"></path>
          </svg>
          {t['friends.apply_button'] || 'Apply for Friend Link'}
        </a>
      </div>
    </header>

    <!-- Friends Grid -->
    {
      filteredFriends.length > 0 ? (
        <div class="grid gap-4 md:grid-cols-2">
          {filteredFriends.map((friend) => (
            <FriendCard friend={friend} />
          ))}
        </div>
      ) : (
        <div class="py-12 text-center">
          <div class="text-muted-foreground mb-4">
            {selectedCategory
              ? t['friends.no_friends_in_category'] ||
                'No friends found in this category'
              : t['friends.no_friends_yet'] || 'No friends added yet'}
          </div>
          {!selectedCategory && (
            <a
              href={`/${lang}/friends/apply`}
              class="text-primary hover:underline"
            >
              {t['friends.be_first'] || 'Be the first to apply!'}
            </a>
          )}
        </div>
      )
    }

    <!-- How to Apply Section -->
    <section class="bg-muted/50 mt-16 rounded-lg p-6">
      <h2 class="mb-4 text-xl font-semibold">
        {t['friends.how_to_apply_title'] || 'How to Apply'}
      </h2>
      <ol class="text-muted-foreground space-y-2 text-sm">
        <li>
          1. {
            t['friends.step1'] ||
              'Click the "Apply for Friend Link" button above'
          }
        </li>
        <li>
          2. {t['friends.step2'] || 'Fill in your website information'}
        </li>
        <li>
          3. {
            t['friends.step3'] || 'Submit a Pull Request with your information'
          }
        </li>
        <li>
          4. {t['friends.step4'] || 'Wait for automatic review and approval'}
        </li>
      </ol>
      <p class="mt-4 text-sm">
        <strong>{t['friends.requirement_title'] || 'Requirements'}:</strong>
        {
          t['friends.requirement_desc'] ||
            'Your website should be active, high-quality, and already link back to this blog.'
        }
      </p>
    </section>
  </div>
</Layout>
