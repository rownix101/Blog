---
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { buttonVariants } from '@/components/ui/button'
import Layout from '@/layouts/Layout.astro'
import { cn } from '@/lib/utils'

// For static 404.html, we'll use the default language
// The 404 page will redirect to language-specific version via JavaScript
const lang = 'zh-cn'
const l = (path: string) => `/${lang}${path}`
---

<Layout class="max-w-3xl" lang={lang}>
  <PageHead slot="head" title="404">
    <script>
      // Detect user's preferred language and redirect to appropriate 404 page
      ;(function () {
        const languages = ['zh-cn', 'en']
        const defaultLang = 'zh-cn'

        // Check cookie first
        const cookies = document.cookie.split(';').reduce((acc, cookie) => {
          const [key, value] = cookie.trim().split('=')
          acc[key] = value
          return acc
        }, {})

        let targetLang = defaultLang

        if (cookies['language'] && languages.includes(cookies['language'])) {
          targetLang = cookies['language']
        } else {
          // Check browser language
          const browserLang = navigator.language.toLowerCase()
          if (languages.includes(browserLang)) {
            targetLang = browserLang
          } else {
            const langPrefix = browserLang.split('-')[0]
            if (langPrefix === 'zh') {
              targetLang = 'zh-cn'
            } else if (languages.includes(langPrefix)) {
              targetLang = langPrefix
            }
          }
        }

        // Redirect to language-specific 404 page
        if (window.location.pathname === '/404.html') {
          window.location.replace('/' + targetLang + '/404/')
        }
      })()
    </script>
  </PageHead>
  <Breadcrumbs items={[{ label: '???', icon: 'lucide:circle-help' }]} />

  <section
    class="flex flex-col items-center justify-center gap-y-4 text-center"
  >
    <div class="max-w-md">
      <h1 class="mb-4 text-3xl font-medium">
        404: {lang === 'en' ? 'Page not found' : '页面未找到'}
      </h1>
      <p class="prose">
        {
          lang === 'en'
            ? "Oops! The page you're looking for doesn't exist."
            : '哎呀！您寻找的页面不存在。'
        }
      </p>
    </div>
    <Link
      href={l('/')}
      class={cn(buttonVariants({ variant: 'outline' }), 'flex gap-x-1.5 group')}
    >
      <span class="transition-transform group-hover:-translate-x-1">&larr;</span
      >
      {lang === 'en' ? 'Go to home page' : '返回首页'}
    </Link>
  </section>
</Layout>
