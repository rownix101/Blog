---
interface Props {
  lang?: string
}

const { lang = 'zh-cn' } = Astro.props as Props

import LanguageSwitcher from '@/components/LanguageSwitcher.astro'
import Link from '@/components/Link.astro'
import MobileMenu from '@/components/MobileMenu.astro'
import SearchButton from '@/components/SearchButton.astro'
import ThemeToggle from '@/components/ThemeToggle.astro'
import { NAV_LINKS } from '@/consts'
import { ui } from '@/i18n/ui'
import { useLocalizedPath, useTranslations } from '@/i18n/utils'
import { Icon } from 'astro-icon/components'

const t = useTranslations(lang as keyof typeof ui)
const l = useLocalizedPath(lang as keyof typeof ui)

const isExternalLink = (href: string) => {
  return href.startsWith('http')
}
---

<header class="bg-background/80 sticky top-0 z-10 backdrop-blur-md">
  <div
    class="mx-auto flex max-w-3xl flex-wrap items-center justify-between gap-4 p-4"
  >
    <Link
      href={l('/')}
      class="group relative flex shrink-0 items-center gap-2 text-xl font-medium"
      reload
    >
      <span
        class="text-foreground font-handwriting group-hover:text-primary text-2xl tracking-wide transition-colors"
      >
        Rownix's Blog
      </span>
      <!-- Decorative dot -->
      <span
        class="bg-primary absolute -top-1 -right-2 h-1.5 w-1.5 rounded-full opacity-0 transition-opacity group-hover:opacity-100"
        aria-hidden="true"></span>
    </Link>
    <div class="ml-auto flex items-center gap-2 md:gap-4">
      <nav class="hidden items-center gap-5 text-sm md:flex">
        {
          NAV_LINKS.map((item) => {
            const isExternal = isExternalLink(item.href)
            const isInsideLink = item.label.toLowerCase() === 'inside'
            const translatedLabel =
              t(`nav.${item.label.toLowerCase()}` as any) || item.label
            const localizedHref = isExternal ? item.href : l(item.href)
            return (
              <Link
                href={localizedHref}
                class={
                  isInsideLink
                    ? 'nav-link text-primary flex items-center gap-1.5 font-medium capitalize'
                    : 'nav-link text-foreground/60 hover:text-foreground flex items-center gap-1.5 capitalize'
                }
              >
                <span>{translatedLabel}</span>
                {isExternal && (
                  <Icon
                    name="lucide:external-link"
                    class={
                      isInsideLink
                        ? 'text-primary size-3.5 flex-shrink-0 opacity-80'
                        : 'size-3.5 flex-shrink-0 opacity-70'
                    }
                    aria-hidden="true"
                  />
                )}
              </Link>
            )
          })
        }
      </nav>
      <div class="bg-border/40 hidden h-5 w-px md:block" aria-hidden="true">
      </div>
      <div class="hidden md:block">
        <SearchButton lang={lang} />
      </div>
      <div class="hidden md:block">
        <LanguageSwitcher />
      </div>
       <MobileMenu lang={lang} />
       <ThemeToggle transition:persist />
     </div>
   </div>
 </header>

<style>
  .nav-link {
    position: relative;
    transition: color 0.2s ease;
  }

  .nav-link::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(
      90deg,
      var(--primary) 0%,
      var(--decorative) 100%
    );
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .nav-link:hover::after {
    transform: scaleX(1);
  }
</style>
