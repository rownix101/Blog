---
interface Props {
  lang?: string
}

const { lang = 'zh-cn' } = Astro.props as Props

import LanguagePicker from '@/components/LanguagePicker.astro'
import Link from '@/components/Link.astro'
import SearchButton from '@/components/react/SearchButton'
import ThemeToggle from '@/components/ThemeToggle.astro'
import MobileMenu from '@/components/ui/mobile-menu'
import { NAV_LINKS } from '@/consts'
import type { ui } from '@/i18n/ui'
import { useLocalizedPath, useTranslations } from '@/i18n/utils'
import { Icon } from 'astro-icon/components'

const t = useTranslations(lang as keyof typeof ui)
const l = useLocalizedPath(lang as keyof typeof ui)

const isExternalLink = (href: string) => {
  return href.startsWith('http')
}
---

<header class="bg-background/50 sticky top-0 z-10 backdrop-blur-md">
  <div
    class="mx-auto flex max-w-3xl flex-wrap items-center justify-between gap-4 p-4"
  >
    <Link
      href={l('/')}
      class="flex shrink-0 items-center gap-2 text-xl font-medium"
      reload
    >
      <img
        src="/static/logo.svg"
        alt="Logo"
        class="hidden size-8 dark:block"
        width="32"
        height="32"
        loading="eager"
        fetchpriority="high"
        transition:persist="logo-dark"
      />
      <img
        src="/static/logod.svg"
        alt="Logo"
        class="block size-8 dark:hidden"
        width="32"
        height="32"
        loading="eager"
        fetchpriority="high"
        transition:persist="logo-light"
      />
      <!-- <span class="hidden min-[400px]:block">{SITE.title}</span> -->
    </Link>
    <div class="flex items-center gap-2 md:gap-4">
      <nav class="hidden items-center gap-4 text-sm sm:gap-6 md:flex">
        {
          NAV_LINKS.map((item) => {
            const isExternal = isExternalLink(item.href)
            const isInsideLink = item.label.toLowerCase() === 'inside'
            const translatedLabel =
              t(`nav.${item.label.toLowerCase()}` as any) || item.label
            const localizedHref = isExternal ? item.href : l(item.href)
            return (
              <Link
                href={localizedHref}
                class={
                  isInsideLink
                    ? 'text-primary hover:text-primary/80 flex items-center gap-1.5 font-medium capitalize transition-colors'
                    : 'text-foreground/60 hover:text-foreground/80 flex items-center gap-1.5 capitalize transition-colors'
                }
              >
                <span>{translatedLabel}</span>
                {isExternal && (
                  <Icon
                    name="lucide:external-link"
                    class={
                      isInsideLink
                        ? 'text-primary size-3.5 flex-shrink-0 opacity-80'
                        : 'size-3.5 flex-shrink-0 opacity-70'
                    }
                    aria-hidden="true"
                  />
                )}
              </Link>
            )
          })
        }
      </nav>
      <div class="bg-border/60 hidden h-6 w-px md:block" aria-hidden="true">
      </div>
      <SearchButton client:idle />
      <LanguagePicker />
      <MobileMenu client:idle transition:persist />
      <ThemeToggle transition:persist />
    </div>
  </div>
</header>
