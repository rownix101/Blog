---
interface Props {
  lang?: string
}

const { lang = 'zh-cn' } = Astro.props as Props

import Link from '@/components/Link.astro'
import { NAV_LINKS, SITE, SOCIAL_LINKS } from '@/consts'
import type { ui } from '@/i18n/ui'
import { useLocalizedPath, useTranslations } from '@/i18n/utils'
import { Icon } from 'astro-icon/components'
import { ErrorBoundary } from './react/ErrorBoundary'
import Newsletter from './react/Newsletter'
import SocialIcons from './SocialIcons.astro'

const t = useTranslations(lang as keyof typeof ui)
const l = useLocalizedPath(lang as keyof typeof ui)

const isExternalLink = (href: string) => {
  return href.startsWith('http')
}
---

<footer class="bg-background/80 border-border/50 border-t backdrop-blur-md">
  <div class="w-full px-4 py-8 sm:py-10">
    <div class="mx-auto flex max-w-3xl flex-col gap-8">
      <!-- Newsletter Section -->
      <div class="grid items-center gap-6 py-6 md:grid-cols-[1fr_auto] md:py-8">
        <div class="text-left">
          <div class="mb-3 flex items-center gap-2">
            <Icon name="lucide:mail" class="text-primary size-5 shrink-0" />
            <h3 class="text-foreground text-lg font-semibold">
              {t('footer.stay_updated')}
            </h3>
          </div>
          <p class="text-muted-foreground text-sm leading-relaxed">
            {t('footer.newsletter_desc')}
          </p>
        </div>
        <div class="w-full md:w-auto md:flex-shrink-0">
          <ErrorBoundary client:load>
            <Newsletter client:load />
          </ErrorBoundary>
        </div>
      </div>

      <!-- Subtle Separator -->
      <div class="bg-border/30 h-px" aria-hidden="true"></div>

      <div
        class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 lg:gap-8"
      >
        <!-- Navigation -->
        <div>
          <h4 class="text-foreground mb-3 text-sm font-semibold">
            {t('footer.navigation')}
          </h4>
          <nav class="flex flex-col gap-2">
            {
              NAV_LINKS.map((item) => {
                const isExternal = isExternalLink(item.href)
                const isInsideLink = item.label.toLowerCase() === 'inside'
                const translatedLabel =
                  t(`nav.${item.label.toLowerCase()}` as any) || item.label
                const localizedHref = isExternal ? item.href : l(item.href)
                return (
                  <Link
                    href={localizedHref}
                    class={
                      isInsideLink
                        ? 'text-primary hover:text-primary/80 group flex items-center gap-1.5 text-sm font-medium capitalize transition-colors'
                        : 'text-muted-foreground hover:text-primary group flex items-center gap-1.5 text-sm capitalize transition-colors'
                    }
                  >
                    <span>{translatedLabel}</span>
                    {isExternal && (
                      <Icon
                        name="lucide:external-link"
                        class={
                          isInsideLink
                            ? 'text-primary size-3 flex-shrink-0 opacity-80 transition-opacity group-hover:opacity-100'
                            : 'group-hover:text-primary size-3 flex-shrink-0 opacity-70 transition-colors group-hover:opacity-100'
                        }
                        aria-hidden="true"
                      />
                    )}
                  </Link>
                )
              })
            }
          </nav>
        </div>

        <!-- Legal -->
        <div>
          <h4 class="text-foreground mb-3 text-sm font-semibold">
            {t('footer.legal')}
          </h4>
          <nav class="flex flex-col gap-2">
            <Link
              href={l('/privacy')}
              class="text-muted-foreground hover:text-primary text-sm transition-colors"
            >
              {t('footer.privacy')}
            </Link>
            <Link
              href={l('/terms')}
              class="text-muted-foreground hover:text-primary text-sm transition-colors"
            >
              {t('footer.terms')}
            </Link>
          </nav>
        </div>

        <!-- Connect -->
        <div>
          <h4 class="text-foreground mb-3 text-sm font-semibold">
            {t('footer.connect')}
          </h4>
          <SocialIcons links={SOCIAL_LINKS} />
        </div>
      </div>

      <!-- Separator -->
      <div class="bg-border/60 h-px" aria-hidden="true"></div>

      <!-- Bottom Section -->
      <div
        class="text-muted-foreground flex flex-col items-center gap-2 text-sm sm:flex-row sm:justify-between"
      >
        <div class="text-center sm:text-left">
          &copy; {new Date().getFullYear()}
          {SITE.title}. {t('footer.rights')}
        </div>
        <div class="text-muted-foreground/80 text-xs">
          <span>
            Theme: <a
              href="https://github.com/meroxdotdev/merox-erudite"
              target="_blank"
              rel="noopener noreferrer"
              class="hover:text-foreground underline transition-colors"
              >merox-erudite</a
            >
          </span>
        </div>
      </div>
    </div>
  </div>
</footer>
